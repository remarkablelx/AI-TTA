# Services 层架构说明

## 📂 目录概述
本目录包含 Flask 应用的服务层实现，作为**业务逻辑的核心载体**，在架构中充当“业务协调者”角色。服务层向上对接路由层（Routes），向下调度模型层（Models），实现业务逻辑与接口响应的解耦，是系统可维护性的关键保障。

## 🧩 模块构成
共包含 6 个核心服务类，每个类对应一个功能域的业务逻辑封装：

1. **管理员服务** (`AdminService`)  
   提供后台管理功能：管理员登录验证、用户管理（查询/删除/筛选）、分析记录管理等关键操作，实现数据统计与事务性删除

2. **记录服务** (`RecordService`)  
   处理用户视频分析记录的全生命周期管理：记录创建、状态跟踪、过期机制实现，支持多维度筛选与关联视频信息获取

3. **报告服务** (`ReportService`)  
   实现分析报告的生成流水线：调用 AI 模型生成姿势评估报告，提供报告存储/查询/更新接口，隔离业务逻辑与算法实现

4. **结果服务** (`ResultService`)  
   管理视频分析核心流程：协调球轨迹跟踪、骨骼点检测、动作切分等算法模块，实现端到端的视频分析流水线

5. **用户服务** (`UserService`)  
   实现用户系统核心功能：双因素认证（密码+验证码）、敏感操作验证、账号注销链式删除，集成头像存储与个人信息管理

6. **视频服务** (`VideoService`)  
   处理视频元数据管理：文件上传/存储路径管理、OpenCV 元数据解析、视频信息动态更新，提供基础媒体处理能力

## ⚙️ 设计原则
- **事务完整性**  
  关键操作（如用户删除）采用数据库事务管理，确保跨模型数据操作的原子性和一致性
  
- **分层隔离**  
  通过 `outerjoin` 实现跨模型查询，保持数据关联性同时避免模型层污染业务逻辑

- **异常控制**  
  统一采用 try-except 块捕获数据库操作异常，配合 `db.session.rollback()` 实现操作安全回滚

- **资源管理**  
  视频/报告文件操作集成路径校验和存储管理，防止无效资源访问

## 🔗 调用关系
服务层作为系统的业务中枢，在架构中承上启下。